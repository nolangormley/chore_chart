{% extends "base.html" %}

{% block content %}
<div class="flex-between" style="margin-bottom: 2rem;">
    <h2>Dashboard</h2>
    <div style="display: flex; gap: 1rem;">
        <button class="btn btn-primary" onclick="openModal('userModal')">
            <span style="margin-right: 0.5rem; font-size: 1.25rem;">+</span> Add User
        </button>
        <button class="btn btn-primary" onclick="openChoreModal()">
            <span style="margin-right: 0.5rem; font-size: 1.25rem;">+</span> New Chore
        </button>
    </div>
</div>

<div style="display: flex; gap: 2rem; margin-bottom: 3rem;">
    <!-- Active User Selector -->
    <div class="card" style="flex: 1; max-width: 300px;">
        <h3 style="margin-bottom: 1rem;">Who is completing this?</h3>
        <select id="userSelect" onchange="updateActiveUser()">
            <option value="">Select a user...</option>
            <!-- Populated by JS -->
        </select>
        <div id="userStats" style="margin-top: 1rem; color: var(--text-muted); font-size: 0.9rem;">
            <!-- Populated by JS -->
        </div>
    </div>

    <!-- Stats Preview (Leaderboard) -->
    <div class="card" style="flex: 2;">
        <h3 style="margin-bottom: 1rem;">Leaderboard</h3>
        <div id="leaderboardList" style="display: flex; gap: 1rem; flex-wrap: wrap;">
            <!-- Populated by JS -->
        </div>
    </div>
</div>

<h3 style="margin-bottom: 1.5rem;">Recurring Tasks</h3>
<div id="recurringChoreList" class="grid" style="margin-bottom: 3rem;">
    <!-- Populated by JS -->
    <div style="grid-column: 1/-1; text-align: center; color: var(--text-muted); padding: 2rem;">
        No recurring tasks found.
    </div>
</div>

<h3 style="margin-bottom: 1.5rem;">One-time Tasks</h3>
<div id="oneOffChoreList" class="grid">
    <!-- Populated by JS -->
    <div style="grid-column: 1/-1; text-align: center; color: var(--text-muted); padding: 2rem;">
        No one-time tasks found.
    </div>
</div>

<!-- Modals -->
<div id="userModal" class="modal">
    <div class="modal-content">
        <h3 style="margin-bottom: 1rem;">Add New User</h3>
        <form onsubmit="handleAddUser(event)">
            <input type="text" id="newUsername" placeholder="Username" required>
            <div style="display: flex; justify-content: flex-end; gap: 1rem;">
                <button type="button" class="btn btn-danger" onclick="closeModal('userModal')">Cancel</button>
                <button type="submit" class="btn btn-primary">Create User</button>
            </div>
        </form>
    </div>
</div>

<div id="choreModal" class="modal">
    <div class="modal-content">
        <h3 id="choreModalTitle" style="margin-bottom: 1rem;">Create New Chore</h3>
        <form onsubmit="handleSaveChore(event)">
            <input type="hidden" id="choreId">
            <input type="text" id="choreTitle" placeholder="Chore Title (e.g., Wash Dishes)" required>
            <textarea id="choreDesc" placeholder="Description (optional)" rows="3"></textarea>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                <input type="number" id="chorePoints" placeholder="Points" required min="1" value="10">
                <div
                    style="display: flex; align-items: center; gap: 0.5rem; background: #0f172a; border: 1px solid var(--border); border-radius: var(--radius); padding: 0 1rem; height: 46px; margin-bottom: 1rem;">
                    <input type="checkbox" id="choreRecurring" style="width: auto; margin: 0;">
                    <label for="choreRecurring" style="cursor: pointer; user-select: none;">Recurring</label>
                </div>
            </div>

            <div style="display: flex; justify-content: flex-end; gap: 1rem; margin-top: 1rem;">
                <button type="button" class="btn btn-danger" onclick="closeModal('choreModal')">Cancel</button>
                <button type="submit" class="btn btn-primary">Create Chore</button>
            </div>
        </form>
    </div>
</div>
<div id="calendarModal" class="modal">
    <div class="modal-content">
        <h3 style="margin-bottom: 1rem;">Add to Calendar</h3>
        <p style="color: var(--text-muted); margin-bottom: 1rem;">Choose a date and time for this chore.</p>
        <form onsubmit="handleSendInvite(event)">
            <input type="hidden" id="calendarChoreId">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                <input type="date" id="calendarDate" required>
                <input type="time" id="calendarTime" required>
            </div>
            <div style="margin-top: 1rem;">
                <label for="calendarRecurrence"
                    style="display: block; margin-bottom: 0.5rem; color: var(--text-muted);">Recurrence</label>
                <select id="calendarRecurrence">
                    <option value="">One-time</option>
                    <option value="weekly">Weekly</option>
                    <option value="biweekly">Bi-weekly (Every 2 weeks)</option>
                    <option value="monthly">Monthly</option>
                </select>
            </div>
            <div style="display: flex; justify-content: flex-end; gap: 1rem; margin-top: 1rem;">
                <button type="button" class="btn btn-danger" onclick="closeModal('calendarModal')">Cancel</button>
                <button type="submit" class="btn btn-primary">Send Invite</button>
            </div>
        </form>
    </div>
</div>
{% endblock %}